{
  "hash": "a867d66e02edb7f753b41595928094ce",
  "result": {
    "markdown": "---\ntitle: \"Challenge 5: Lime\"\nauthor: \"Andreas Jessen\"\n---\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-1_069acc569a59c4cdc0c21bfdb5e3d785'}\n\n```{.r .cell-code}\n# Load Libraries \nlibrary(tidyverse)\nlibrary(rsample)\nlibrary(recipes)\nlibrary(readxl)\nlibrary(h2o)\nlibrary(lime)\n```\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-2_e5f388d2b5d6003a0e1eb4607590828f'}\n\n```{.r .cell-code}\n# Load Data\nemployee_attrition_tbl <- read_csv(\"Data/datasets-1067-1925-WA_Fn-UseC_-HR-Employee-Attrition.csv\")\ndefinitions_raw_tbl    <- read_excel(\"Data/data_definitions.xlsx\", sheet = 1, col_names = FALSE)\n\nprocess_hr_data_readable <- function(data, definitions_tbl) {\n\n    definitions_list <- definitions_tbl %>%\n        fill(...1, .direction = \"down\") %>%\n        filter(!is.na(...2)) %>%\n        separate(...2, into = c(\"key\", \"value\"), sep = \" '\", remove = TRUE) %>%\n        rename(column_name = ...1) %>%\n        mutate(key = as.numeric(key)) %>%\n        mutate(value = value %>% str_replace(pattern = \"'\", replacement = \"\")) %>%\n        split(.$column_name) %>%\n        map(~ select(., -column_name)) %>%\n        map(~ mutate(., value = as_factor(value))) \n    \n    for (i in seq_along(definitions_list)) {\n        list_name <- names(definitions_list)[i]\n        colnames(definitions_list[[i]]) <- c(list_name, paste0(list_name, \"_value\"))\n    }\n    \n    data_merged_tbl <- list(HR_Data = data) %>%\n        append(definitions_list, after = 1) %>%\n        reduce(left_join) %>%\n        select(-one_of(names(definitions_list))) %>%\n        set_names(str_replace_all(names(.), pattern = \"_value\", \n                                            replacement = \"\")) %>%\n        select(sort(names(.))) %>%\n        mutate_if(is.character, as.factor) %>%\n        mutate(\n            BusinessTravel = BusinessTravel %>% fct_relevel(\"Non-Travel\", \n                                                            \"Travel_Rarely\", \n                                                            \"Travel_Frequently\"),\n            MaritalStatus  = MaritalStatus %>% fct_relevel(\"Single\", \n                                                           \"Married\", \n                                                           \"Divorced\")\n        )\n    \n    return(data_merged_tbl)\n    \n}\n\nemployee_attrition_readable_tbl <- process_hr_data_readable(employee_attrition_tbl, definitions_raw_tbl)\n\n# Split into test and train\nset.seed(seed = 1113)\nsplit_obj <- rsample::initial_split(employee_attrition_readable_tbl, prop = 0.85)\n\n# Assign training and test data\ntrain_readable_tbl <- training(split_obj)\ntest_readable_tbl  <- testing(split_obj)\n\n# ML Preprocessing Recipe \nrecipe_obj <- recipe(Attrition ~ ., data = train_readable_tbl) %>%\n                step_zv(all_predictors()) %>%\n                step_mutate_at(c(\"JobLevel\", \"StockOptionLevel\"), fn = as.factor) %>% \n                prep()\n\nrecipe_obj\n\ntrain_tbl <- bake(recipe_obj, new_data = train_readable_tbl)\ntest_tbl  <- bake(recipe_obj, new_data = test_readable_tbl)\n```\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-3_a5a3936e48d79961c1bd568a852d0e6b'}\n\n```{.r .cell-code}\n# 2. Models ----\n\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  Connection successful!\n#> \n#> R is connected to the H2O cluster: \n#>     H2O cluster uptime:         1 days 17 hours \n#>     H2O cluster timezone:       Europe/Berlin \n#>     H2O data parsing timezone:  UTC \n#>     H2O cluster version:        3.40.0.4 \n#>     H2O cluster version age:    1 month and 17 days \n#>     H2O cluster name:           H2O_started_from_R_andi_gcu544 \n#>     H2O cluster total nodes:    1 \n#>     H2O cluster total memory:   2.65 GB \n#>     H2O cluster total cores:    4 \n#>     H2O cluster allowed cores:  4 \n#>     H2O cluster healthy:        TRUE \n#>     H2O Connection ip:          localhost \n#>     H2O Connection port:        54321 \n#>     H2O Connection proxy:       NA \n#>     H2O Internal Security:      FALSE \n#>     R Version:                  R version 4.3.0 (2023-04-21)\n```\n:::\n\n```{.r .cell-code}\n# Split data into a training and a validation data frame\n# Setting the seed is just for reproducability\nsplit_h2o <- h2o.splitFrame(as.h2o(train_tbl), ratios = c(0.85), seed = 1234)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ntrain_h2o <- split_h2o[[1]]\nvalid_h2o <- split_h2o[[2]]\ntest_h2o  <- as.h2o(test_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\n# Set the target and predictors\ny <- \"Attrition\"\nx <- setdiff(names(train_h2o), y)\n```\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-4_4ca97a486f6a9ec2569d957461c590b1'}\n\n```{.r .cell-code}\nautoml_models_h2o <- h2o.automl(\n  x = x,\n  y = y,\n  training_frame    = train_h2o,\n  validation_frame  = valid_h2o,\n  leaderboard_frame = test_h2o,\n  max_runtime_secs  = 30,\n  nfolds            = 5 \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |==                                                                    |   3%\n#> 11:20:13.273: User specified a validation frame with cross-validation still enabled. Please note that the models will still be validated using cross-validation only, the validation frame will be used to provide purely informative validation metrics on the trained models.\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\nautoml_leader <- automl_models_h2o@leader\n```\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-5_14ef9209bb82d7a7eb9547170d5155c4'}\n\n```{.r .cell-code}\npredictions_tbl <- automl_leader %>% \n    h2o.predict(newdata = as.h2o(test_tbl)) %>%\n    as.tibble() %>%\n    bind_cols(\n        test_tbl %>%\n            select(Attrition, EmployeeNumber)\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: `as.tibble()` was deprecated in tibble 2.0.0.\n#> ℹ Please use `as_tibble()` instead.\n#> ℹ The signature and semantics have changed, see `?as_tibble`.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\npredictions_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"predict\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"No\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Yes\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Attrition\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"EmployeeNumber\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Yes\",\"2\":\"0.64589494\",\"3\":\"0.354105062\",\"4\":\"No\",\"5\":\"10\"},{\"1\":\"No\",\"2\":\"0.76335387\",\"3\":\"0.236646125\",\"4\":\"No\",\"5\":\"16\"},{\"1\":\"No\",\"2\":\"0.90312489\",\"3\":\"0.096875111\",\"4\":\"No\",\"5\":\"30\"},{\"1\":\"No\",\"2\":\"0.92253707\",\"3\":\"0.077462930\",\"4\":\"Yes\",\"5\":\"31\"},{\"1\":\"No\",\"2\":\"0.96591624\",\"3\":\"0.034083757\",\"4\":\"No\",\"5\":\"40\"},{\"1\":\"No\",\"2\":\"0.99312818\",\"3\":\"0.006871815\",\"4\":\"Yes\",\"5\":\"42\"},{\"1\":\"No\",\"2\":\"0.99496932\",\"3\":\"0.005030677\",\"4\":\"No\",\"5\":\"46\"},{\"1\":\"Yes\",\"2\":\"0.22515207\",\"3\":\"0.774847926\",\"4\":\"Yes\",\"5\":\"55\"},{\"1\":\"Yes\",\"2\":\"0.25234585\",\"3\":\"0.747654153\",\"4\":\"Yes\",\"5\":\"64\"},{\"1\":\"No\",\"2\":\"0.98817762\",\"3\":\"0.011822383\",\"4\":\"No\",\"5\":\"77\"},{\"1\":\"No\",\"2\":\"0.73287626\",\"3\":\"0.267123735\",\"4\":\"No\",\"5\":\"80\"},{\"1\":\"No\",\"2\":\"0.95392797\",\"3\":\"0.046072033\",\"4\":\"No\",\"5\":\"83\"},{\"1\":\"No\",\"2\":\"0.94243024\",\"3\":\"0.057569763\",\"4\":\"No\",\"5\":\"85\"},{\"1\":\"No\",\"2\":\"0.99730183\",\"3\":\"0.002698171\",\"4\":\"No\",\"5\":\"96\"},{\"1\":\"No\",\"2\":\"0.89603116\",\"3\":\"0.103968842\",\"4\":\"No\",\"5\":\"121\"},{\"1\":\"No\",\"2\":\"0.89329245\",\"3\":\"0.106707552\",\"4\":\"No\",\"5\":\"125\"},{\"1\":\"No\",\"2\":\"0.99665527\",\"3\":\"0.003344730\",\"4\":\"No\",\"5\":\"140\"},{\"1\":\"No\",\"2\":\"0.82975526\",\"3\":\"0.170244743\",\"4\":\"No\",\"5\":\"145\"},{\"1\":\"No\",\"2\":\"0.90392216\",\"3\":\"0.096077841\",\"4\":\"No\",\"5\":\"158\"},{\"1\":\"No\",\"2\":\"0.77320175\",\"3\":\"0.226798255\",\"4\":\"No\",\"5\":\"159\"},{\"1\":\"No\",\"2\":\"0.95749311\",\"3\":\"0.042506885\",\"4\":\"No\",\"5\":\"160\"},{\"1\":\"Yes\",\"2\":\"0.34267205\",\"3\":\"0.657327954\",\"4\":\"Yes\",\"5\":\"163\"},{\"1\":\"No\",\"2\":\"0.98009813\",\"3\":\"0.019901866\",\"4\":\"Yes\",\"5\":\"165\"},{\"1\":\"No\",\"2\":\"0.91495784\",\"3\":\"0.085042161\",\"4\":\"Yes\",\"5\":\"179\"},{\"1\":\"No\",\"2\":\"0.82449983\",\"3\":\"0.175500167\",\"4\":\"No\",\"5\":\"184\"},{\"1\":\"No\",\"2\":\"0.93851459\",\"3\":\"0.061485413\",\"4\":\"No\",\"5\":\"193\"},{\"1\":\"No\",\"2\":\"0.86657299\",\"3\":\"0.133427013\",\"4\":\"No\",\"5\":\"194\"},{\"1\":\"No\",\"2\":\"0.91662533\",\"3\":\"0.083374672\",\"4\":\"No\",\"5\":\"197\"},{\"1\":\"No\",\"2\":\"0.95725934\",\"3\":\"0.042740658\",\"4\":\"No\",\"5\":\"199\"},{\"1\":\"No\",\"2\":\"0.93591982\",\"3\":\"0.064080180\",\"4\":\"No\",\"5\":\"200\"},{\"1\":\"No\",\"2\":\"0.96896253\",\"3\":\"0.031037474\",\"4\":\"No\",\"5\":\"204\"},{\"1\":\"No\",\"2\":\"0.97721227\",\"3\":\"0.022787729\",\"4\":\"No\",\"5\":\"206\"},{\"1\":\"No\",\"2\":\"0.98161070\",\"3\":\"0.018389299\",\"4\":\"No\",\"5\":\"217\"},{\"1\":\"No\",\"2\":\"0.79799709\",\"3\":\"0.202002907\",\"4\":\"No\",\"5\":\"224\"},{\"1\":\"No\",\"2\":\"0.98896160\",\"3\":\"0.011038401\",\"4\":\"No\",\"5\":\"239\"},{\"1\":\"Yes\",\"2\":\"0.39117084\",\"3\":\"0.608829159\",\"4\":\"Yes\",\"5\":\"248\"},{\"1\":\"No\",\"2\":\"0.99560089\",\"3\":\"0.004399115\",\"4\":\"No\",\"5\":\"252\"},{\"1\":\"No\",\"2\":\"0.99681375\",\"3\":\"0.003186250\",\"4\":\"No\",\"5\":\"270\"},{\"1\":\"No\",\"2\":\"0.96232238\",\"3\":\"0.037677624\",\"4\":\"No\",\"5\":\"273\"},{\"1\":\"No\",\"2\":\"0.91673390\",\"3\":\"0.083266101\",\"4\":\"Yes\",\"5\":\"291\"},{\"1\":\"No\",\"2\":\"0.98170886\",\"3\":\"0.018291136\",\"4\":\"No\",\"5\":\"307\"},{\"1\":\"No\",\"2\":\"0.97878862\",\"3\":\"0.021211381\",\"4\":\"No\",\"5\":\"309\"},{\"1\":\"No\",\"2\":\"0.81440849\",\"3\":\"0.185591509\",\"4\":\"No\",\"5\":\"311\"},{\"1\":\"No\",\"2\":\"0.98335714\",\"3\":\"0.016642861\",\"4\":\"No\",\"5\":\"312\"},{\"1\":\"No\",\"2\":\"0.84871389\",\"3\":\"0.151286109\",\"4\":\"No\",\"5\":\"314\"},{\"1\":\"No\",\"2\":\"0.75126418\",\"3\":\"0.248735819\",\"4\":\"No\",\"5\":\"321\"},{\"1\":\"No\",\"2\":\"0.98720975\",\"3\":\"0.012790250\",\"4\":\"No\",\"5\":\"327\"},{\"1\":\"No\",\"2\":\"0.89711559\",\"3\":\"0.102884414\",\"4\":\"No\",\"5\":\"333\"},{\"1\":\"No\",\"2\":\"0.98154196\",\"3\":\"0.018458036\",\"4\":\"No\",\"5\":\"334\"},{\"1\":\"No\",\"2\":\"0.98708303\",\"3\":\"0.012916974\",\"4\":\"No\",\"5\":\"361\"},{\"1\":\"No\",\"2\":\"0.97601619\",\"3\":\"0.023983805\",\"4\":\"No\",\"5\":\"367\"},{\"1\":\"No\",\"2\":\"0.73237463\",\"3\":\"0.267625373\",\"4\":\"No\",\"5\":\"382\"},{\"1\":\"Yes\",\"2\":\"0.45227702\",\"3\":\"0.547722975\",\"4\":\"No\",\"5\":\"390\"},{\"1\":\"No\",\"2\":\"0.98707968\",\"3\":\"0.012920316\",\"4\":\"No\",\"5\":\"395\"},{\"1\":\"No\",\"2\":\"0.95747308\",\"3\":\"0.042526918\",\"4\":\"No\",\"5\":\"406\"},{\"1\":\"No\",\"2\":\"0.96815362\",\"3\":\"0.031846378\",\"4\":\"No\",\"5\":\"412\"},{\"1\":\"No\",\"2\":\"0.99439155\",\"3\":\"0.005608447\",\"4\":\"No\",\"5\":\"417\"},{\"1\":\"No\",\"2\":\"0.96644950\",\"3\":\"0.033550502\",\"4\":\"No\",\"5\":\"422\"},{\"1\":\"No\",\"2\":\"0.96706910\",\"3\":\"0.032930897\",\"4\":\"Yes\",\"5\":\"433\"},{\"1\":\"No\",\"2\":\"0.87826880\",\"3\":\"0.121731198\",\"4\":\"No\",\"5\":\"444\"},{\"1\":\"No\",\"2\":\"0.84880472\",\"3\":\"0.151195279\",\"4\":\"No\",\"5\":\"451\"},{\"1\":\"No\",\"2\":\"0.98735558\",\"3\":\"0.012644423\",\"4\":\"No\",\"5\":\"452\"},{\"1\":\"No\",\"2\":\"0.96486643\",\"3\":\"0.035133574\",\"4\":\"No\",\"5\":\"456\"},{\"1\":\"No\",\"2\":\"0.97660450\",\"3\":\"0.023395504\",\"4\":\"No\",\"5\":\"465\"},{\"1\":\"No\",\"2\":\"0.80920376\",\"3\":\"0.190796243\",\"4\":\"No\",\"5\":\"467\"},{\"1\":\"No\",\"2\":\"0.95525918\",\"3\":\"0.044740818\",\"4\":\"No\",\"5\":\"474\"},{\"1\":\"No\",\"2\":\"0.96869507\",\"3\":\"0.031304929\",\"4\":\"No\",\"5\":\"486\"},{\"1\":\"No\",\"2\":\"0.99045979\",\"3\":\"0.009540209\",\"4\":\"No\",\"5\":\"487\"},{\"1\":\"No\",\"2\":\"0.90461527\",\"3\":\"0.095384734\",\"4\":\"No\",\"5\":\"495\"},{\"1\":\"No\",\"2\":\"0.94223318\",\"3\":\"0.057766825\",\"4\":\"No\",\"5\":\"496\"},{\"1\":\"No\",\"2\":\"0.84761594\",\"3\":\"0.152384064\",\"4\":\"Yes\",\"5\":\"510\"},{\"1\":\"No\",\"2\":\"0.80466501\",\"3\":\"0.195334994\",\"4\":\"No\",\"5\":\"513\"},{\"1\":\"No\",\"2\":\"0.84844334\",\"3\":\"0.151556658\",\"4\":\"Yes\",\"5\":\"538\"},{\"1\":\"No\",\"2\":\"0.97947131\",\"3\":\"0.020528693\",\"4\":\"No\",\"5\":\"547\"},{\"1\":\"No\",\"2\":\"0.83643345\",\"3\":\"0.163566553\",\"4\":\"No\",\"5\":\"549\"},{\"1\":\"No\",\"2\":\"0.99890325\",\"3\":\"0.001096751\",\"4\":\"No\",\"5\":\"550\"},{\"1\":\"No\",\"2\":\"0.99676276\",\"3\":\"0.003237236\",\"4\":\"No\",\"5\":\"558\"},{\"1\":\"No\",\"2\":\"0.93484061\",\"3\":\"0.065159389\",\"4\":\"No\",\"5\":\"567\"},{\"1\":\"No\",\"2\":\"0.95563615\",\"3\":\"0.044363847\",\"4\":\"No\",\"5\":\"568\"},{\"1\":\"No\",\"2\":\"0.99279565\",\"3\":\"0.007204346\",\"4\":\"No\",\"5\":\"574\"},{\"1\":\"No\",\"2\":\"0.99181085\",\"3\":\"0.008189147\",\"4\":\"No\",\"5\":\"579\"},{\"1\":\"No\",\"2\":\"0.99692401\",\"3\":\"0.003075993\",\"4\":\"No\",\"5\":\"581\"},{\"1\":\"No\",\"2\":\"0.85632016\",\"3\":\"0.143679838\",\"4\":\"No\",\"5\":\"591\"},{\"1\":\"No\",\"2\":\"0.95228457\",\"3\":\"0.047715429\",\"4\":\"No\",\"5\":\"623\"},{\"1\":\"No\",\"2\":\"0.97231566\",\"3\":\"0.027684342\",\"4\":\"No\",\"5\":\"671\"},{\"1\":\"No\",\"2\":\"0.96202445\",\"3\":\"0.037975552\",\"4\":\"No\",\"5\":\"679\"},{\"1\":\"No\",\"2\":\"0.96893749\",\"3\":\"0.031062512\",\"4\":\"No\",\"5\":\"690\"},{\"1\":\"No\",\"2\":\"0.98307071\",\"3\":\"0.016929291\",\"4\":\"No\",\"5\":\"691\"},{\"1\":\"No\",\"2\":\"0.98836526\",\"3\":\"0.011634737\",\"4\":\"No\",\"5\":\"692\"},{\"1\":\"No\",\"2\":\"0.72314838\",\"3\":\"0.276851618\",\"4\":\"Yes\",\"5\":\"701\"},{\"1\":\"Yes\",\"2\":\"0.17660734\",\"3\":\"0.823392659\",\"4\":\"Yes\",\"5\":\"702\"},{\"1\":\"No\",\"2\":\"0.99079237\",\"3\":\"0.009207635\",\"4\":\"No\",\"5\":\"707\"},{\"1\":\"No\",\"2\":\"0.96131329\",\"3\":\"0.038686708\",\"4\":\"No\",\"5\":\"712\"},{\"1\":\"No\",\"2\":\"0.98017565\",\"3\":\"0.019824354\",\"4\":\"No\",\"5\":\"714\"},{\"1\":\"No\",\"2\":\"0.88857142\",\"3\":\"0.111428579\",\"4\":\"No\",\"5\":\"716\"},{\"1\":\"No\",\"2\":\"0.96448655\",\"3\":\"0.035513446\",\"4\":\"No\",\"5\":\"733\"},{\"1\":\"No\",\"2\":\"0.98943705\",\"3\":\"0.010562947\",\"4\":\"No\",\"5\":\"734\"},{\"1\":\"No\",\"2\":\"0.83955037\",\"3\":\"0.160449635\",\"4\":\"No\",\"5\":\"758\"},{\"1\":\"No\",\"2\":\"0.98137806\",\"3\":\"0.018621943\",\"4\":\"No\",\"5\":\"775\"},{\"1\":\"No\",\"2\":\"0.82854522\",\"3\":\"0.171454781\",\"4\":\"No\",\"5\":\"784\"},{\"1\":\"No\",\"2\":\"0.98681870\",\"3\":\"0.013181300\",\"4\":\"No\",\"5\":\"786\"},{\"1\":\"Yes\",\"2\":\"0.58534400\",\"3\":\"0.414655996\",\"4\":\"Yes\",\"5\":\"796\"},{\"1\":\"No\",\"2\":\"0.98011009\",\"3\":\"0.019889905\",\"4\":\"No\",\"5\":\"820\"},{\"1\":\"No\",\"2\":\"0.91126838\",\"3\":\"0.088731620\",\"4\":\"Yes\",\"5\":\"825\"},{\"1\":\"No\",\"2\":\"0.88329799\",\"3\":\"0.116702011\",\"4\":\"No\",\"5\":\"834\"},{\"1\":\"No\",\"2\":\"0.88037571\",\"3\":\"0.119624294\",\"4\":\"No\",\"5\":\"837\"},{\"1\":\"No\",\"2\":\"0.96233494\",\"3\":\"0.037665055\",\"4\":\"Yes\",\"5\":\"840\"},{\"1\":\"No\",\"2\":\"0.92362995\",\"3\":\"0.076370051\",\"4\":\"No\",\"5\":\"861\"},{\"1\":\"No\",\"2\":\"0.87916733\",\"3\":\"0.120832674\",\"4\":\"No\",\"5\":\"862\"},{\"1\":\"Yes\",\"2\":\"0.56282755\",\"3\":\"0.437172446\",\"4\":\"No\",\"5\":\"879\"},{\"1\":\"No\",\"2\":\"0.93681644\",\"3\":\"0.063183556\",\"4\":\"No\",\"5\":\"895\"},{\"1\":\"Yes\",\"2\":\"0.31155116\",\"3\":\"0.688448840\",\"4\":\"No\",\"5\":\"913\"},{\"1\":\"No\",\"2\":\"0.76889652\",\"3\":\"0.231103477\",\"4\":\"Yes\",\"5\":\"927\"},{\"1\":\"No\",\"2\":\"0.96237255\",\"3\":\"0.037627450\",\"4\":\"No\",\"5\":\"930\"},{\"1\":\"No\",\"2\":\"0.96437819\",\"3\":\"0.035621815\",\"4\":\"No\",\"5\":\"940\"},{\"1\":\"No\",\"2\":\"0.97827452\",\"3\":\"0.021725483\",\"4\":\"No\",\"5\":\"949\"},{\"1\":\"Yes\",\"2\":\"0.20724373\",\"3\":\"0.792756272\",\"4\":\"Yes\",\"5\":\"960\"},{\"1\":\"Yes\",\"2\":\"0.32578491\",\"3\":\"0.674215086\",\"4\":\"Yes\",\"5\":\"970\"},{\"1\":\"No\",\"2\":\"0.96679167\",\"3\":\"0.033208331\",\"4\":\"No\",\"5\":\"981\"},{\"1\":\"No\",\"2\":\"0.78201797\",\"3\":\"0.217982031\",\"4\":\"Yes\",\"5\":\"986\"},{\"1\":\"No\",\"2\":\"0.99279017\",\"3\":\"0.007209825\",\"4\":\"No\",\"5\":\"996\"},{\"1\":\"No\",\"2\":\"0.97706469\",\"3\":\"0.022935306\",\"4\":\"No\",\"5\":\"1005\"},{\"1\":\"No\",\"2\":\"0.79373608\",\"3\":\"0.206263916\",\"4\":\"No\",\"5\":\"1014\"},{\"1\":\"Yes\",\"2\":\"0.32704845\",\"3\":\"0.672951546\",\"4\":\"Yes\",\"5\":\"1016\"},{\"1\":\"No\",\"2\":\"0.99422952\",\"3\":\"0.005770480\",\"4\":\"No\",\"5\":\"1018\"},{\"1\":\"Yes\",\"2\":\"0.48635506\",\"3\":\"0.513644936\",\"4\":\"No\",\"5\":\"1019\"},{\"1\":\"No\",\"2\":\"0.92145954\",\"3\":\"0.078540464\",\"4\":\"No\",\"5\":\"1034\"},{\"1\":\"Yes\",\"2\":\"0.68211397\",\"3\":\"0.317886035\",\"4\":\"No\",\"5\":\"1055\"},{\"1\":\"Yes\",\"2\":\"0.60432421\",\"3\":\"0.395675794\",\"4\":\"Yes\",\"5\":\"1079\"},{\"1\":\"No\",\"2\":\"0.93631714\",\"3\":\"0.063682857\",\"4\":\"Yes\",\"5\":\"1098\"},{\"1\":\"Yes\",\"2\":\"0.64667176\",\"3\":\"0.353328244\",\"4\":\"Yes\",\"5\":\"1107\"},{\"1\":\"No\",\"2\":\"0.98425138\",\"3\":\"0.015748617\",\"4\":\"No\",\"5\":\"1114\"},{\"1\":\"No\",\"2\":\"0.97281021\",\"3\":\"0.027189792\",\"4\":\"No\",\"5\":\"1115\"},{\"1\":\"No\",\"2\":\"0.79801949\",\"3\":\"0.201980512\",\"4\":\"No\",\"5\":\"1136\"},{\"1\":\"No\",\"2\":\"0.94214336\",\"3\":\"0.057856636\",\"4\":\"No\",\"5\":\"1150\"},{\"1\":\"No\",\"2\":\"0.84172975\",\"3\":\"0.158270251\",\"4\":\"Yes\",\"5\":\"1165\"},{\"1\":\"No\",\"2\":\"0.92671433\",\"3\":\"0.073285669\",\"4\":\"No\",\"5\":\"1179\"},{\"1\":\"No\",\"2\":\"0.86697465\",\"3\":\"0.133025346\",\"4\":\"No\",\"5\":\"1185\"},{\"1\":\"No\",\"2\":\"0.88567680\",\"3\":\"0.114323202\",\"4\":\"Yes\",\"5\":\"1200\"},{\"1\":\"No\",\"2\":\"0.92098182\",\"3\":\"0.079018182\",\"4\":\"No\",\"5\":\"1207\"},{\"1\":\"Yes\",\"2\":\"0.57323044\",\"3\":\"0.426769559\",\"4\":\"Yes\",\"5\":\"1210\"},{\"1\":\"No\",\"2\":\"0.85758958\",\"3\":\"0.142410424\",\"4\":\"No\",\"5\":\"1211\"},{\"1\":\"No\",\"2\":\"0.76523143\",\"3\":\"0.234768571\",\"4\":\"No\",\"5\":\"1234\"},{\"1\":\"No\",\"2\":\"0.98974069\",\"3\":\"0.010259310\",\"4\":\"No\",\"5\":\"1238\"},{\"1\":\"Yes\",\"2\":\"0.57130947\",\"3\":\"0.428690525\",\"4\":\"No\",\"5\":\"1244\"},{\"1\":\"No\",\"2\":\"0.97885506\",\"3\":\"0.021144937\",\"4\":\"No\",\"5\":\"1256\"},{\"1\":\"No\",\"2\":\"0.94133249\",\"3\":\"0.058667507\",\"4\":\"No\",\"5\":\"1257\"},{\"1\":\"No\",\"2\":\"0.93231550\",\"3\":\"0.067684496\",\"4\":\"No\",\"5\":\"1265\"},{\"1\":\"Yes\",\"2\":\"0.06256478\",\"3\":\"0.937435225\",\"4\":\"Yes\",\"5\":\"1273\"},{\"1\":\"No\",\"2\":\"0.91267108\",\"3\":\"0.087328920\",\"4\":\"No\",\"5\":\"1278\"},{\"1\":\"No\",\"2\":\"0.95362276\",\"3\":\"0.046377240\",\"4\":\"No\",\"5\":\"1306\"},{\"1\":\"No\",\"2\":\"0.96028130\",\"3\":\"0.039718701\",\"4\":\"No\",\"5\":\"1317\"},{\"1\":\"Yes\",\"2\":\"0.25392358\",\"3\":\"0.746076415\",\"4\":\"Yes\",\"5\":\"1318\"},{\"1\":\"No\",\"2\":\"0.98512071\",\"3\":\"0.014879290\",\"4\":\"No\",\"5\":\"1338\"},{\"1\":\"No\",\"2\":\"0.99523211\",\"3\":\"0.004767891\",\"4\":\"No\",\"5\":\"1346\"},{\"1\":\"No\",\"2\":\"0.97193154\",\"3\":\"0.028068460\",\"4\":\"No\",\"5\":\"1349\"},{\"1\":\"No\",\"2\":\"0.88851507\",\"3\":\"0.111484929\",\"4\":\"No\",\"5\":\"1350\"},{\"1\":\"Yes\",\"2\":\"0.50481821\",\"3\":\"0.495181788\",\"4\":\"Yes\",\"5\":\"1379\"},{\"1\":\"Yes\",\"2\":\"0.64724864\",\"3\":\"0.352751360\",\"4\":\"No\",\"5\":\"1403\"},{\"1\":\"No\",\"2\":\"0.95572637\",\"3\":\"0.044273628\",\"4\":\"No\",\"5\":\"1431\"},{\"1\":\"No\",\"2\":\"0.95467444\",\"3\":\"0.045325563\",\"4\":\"No\",\"5\":\"1435\"},{\"1\":\"No\",\"2\":\"0.77386290\",\"3\":\"0.226137095\",\"4\":\"No\",\"5\":\"1440\"},{\"1\":\"No\",\"2\":\"0.80830975\",\"3\":\"0.191690248\",\"4\":\"No\",\"5\":\"1465\"},{\"1\":\"No\",\"2\":\"0.91456159\",\"3\":\"0.085438409\",\"4\":\"No\",\"5\":\"1466\"},{\"1\":\"No\",\"2\":\"0.81920637\",\"3\":\"0.180793629\",\"4\":\"No\",\"5\":\"1481\"},{\"1\":\"No\",\"2\":\"0.92866318\",\"3\":\"0.071336823\",\"4\":\"No\",\"5\":\"1482\"},{\"1\":\"No\",\"2\":\"0.93949997\",\"3\":\"0.060500028\",\"4\":\"No\",\"5\":\"1485\"},{\"1\":\"Yes\",\"2\":\"0.24484814\",\"3\":\"0.755151864\",\"4\":\"Yes\",\"5\":\"1504\"},{\"1\":\"No\",\"2\":\"0.87093046\",\"3\":\"0.129069537\",\"4\":\"No\",\"5\":\"1507\"},{\"1\":\"No\",\"2\":\"0.95048101\",\"3\":\"0.049518987\",\"4\":\"No\",\"5\":\"1513\"},{\"1\":\"Yes\",\"2\":\"0.41363412\",\"3\":\"0.586365884\",\"4\":\"Yes\",\"5\":\"1522\"},{\"1\":\"No\",\"2\":\"0.79896088\",\"3\":\"0.201039123\",\"4\":\"Yes\",\"5\":\"1534\"},{\"1\":\"No\",\"2\":\"0.73114403\",\"3\":\"0.268855975\",\"4\":\"Yes\",\"5\":\"1537\"},{\"1\":\"No\",\"2\":\"0.97630493\",\"3\":\"0.023695074\",\"4\":\"No\",\"5\":\"1543\"},{\"1\":\"No\",\"2\":\"0.84588376\",\"3\":\"0.154116244\",\"4\":\"No\",\"5\":\"1547\"},{\"1\":\"No\",\"2\":\"0.93389987\",\"3\":\"0.066100133\",\"4\":\"No\",\"5\":\"1563\"},{\"1\":\"No\",\"2\":\"0.99254636\",\"3\":\"0.007453643\",\"4\":\"No\",\"5\":\"1578\"},{\"1\":\"No\",\"2\":\"0.96282736\",\"3\":\"0.037172636\",\"4\":\"No\",\"5\":\"1601\"},{\"1\":\"Yes\",\"2\":\"0.34347356\",\"3\":\"0.656526443\",\"4\":\"Yes\",\"5\":\"1604\"},{\"1\":\"Yes\",\"2\":\"0.69250111\",\"3\":\"0.307498886\",\"4\":\"No\",\"5\":\"1612\"},{\"1\":\"No\",\"2\":\"0.97591579\",\"3\":\"0.024084209\",\"4\":\"No\",\"5\":\"1615\"},{\"1\":\"Yes\",\"2\":\"0.17315251\",\"3\":\"0.826847489\",\"4\":\"Yes\",\"5\":\"1624\"},{\"1\":\"No\",\"2\":\"0.87363353\",\"3\":\"0.126366471\",\"4\":\"No\",\"5\":\"1633\"},{\"1\":\"No\",\"2\":\"0.99804238\",\"3\":\"0.001957616\",\"4\":\"No\",\"5\":\"1635\"},{\"1\":\"No\",\"2\":\"0.95143789\",\"3\":\"0.048562111\",\"4\":\"No\",\"5\":\"1638\"},{\"1\":\"Yes\",\"2\":\"0.36679529\",\"3\":\"0.633204706\",\"4\":\"Yes\",\"5\":\"1645\"},{\"1\":\"No\",\"2\":\"0.78569106\",\"3\":\"0.214308941\",\"4\":\"No\",\"5\":\"1647\"},{\"1\":\"No\",\"2\":\"0.92668926\",\"3\":\"0.073310736\",\"4\":\"No\",\"5\":\"1682\"},{\"1\":\"No\",\"2\":\"0.86665714\",\"3\":\"0.133342861\",\"4\":\"Yes\",\"5\":\"1691\"},{\"1\":\"No\",\"2\":\"0.99134853\",\"3\":\"0.008651471\",\"4\":\"No\",\"5\":\"1697\"},{\"1\":\"No\",\"2\":\"0.95231088\",\"3\":\"0.047689118\",\"4\":\"No\",\"5\":\"1724\"},{\"1\":\"No\",\"2\":\"0.96278201\",\"3\":\"0.037217986\",\"4\":\"No\",\"5\":\"1732\"},{\"1\":\"No\",\"2\":\"0.99450289\",\"3\":\"0.005497106\",\"4\":\"No\",\"5\":\"1771\"},{\"1\":\"Yes\",\"2\":\"0.71092413\",\"3\":\"0.289075870\",\"4\":\"Yes\",\"5\":\"1783\"},{\"1\":\"No\",\"2\":\"0.81602433\",\"3\":\"0.183975666\",\"4\":\"No\",\"5\":\"1790\"},{\"1\":\"Yes\",\"2\":\"0.63218473\",\"3\":\"0.367815265\",\"4\":\"Yes\",\"5\":\"1797\"},{\"1\":\"No\",\"2\":\"0.96831145\",\"3\":\"0.031688545\",\"4\":\"No\",\"5\":\"1798\"},{\"1\":\"No\",\"2\":\"0.96872532\",\"3\":\"0.031274678\",\"4\":\"No\",\"5\":\"1803\"},{\"1\":\"No\",\"2\":\"0.82262858\",\"3\":\"0.177371416\",\"4\":\"No\",\"5\":\"1813\"},{\"1\":\"No\",\"2\":\"0.76686819\",\"3\":\"0.233131808\",\"4\":\"Yes\",\"5\":\"1818\"},{\"1\":\"No\",\"2\":\"0.95438175\",\"3\":\"0.045618247\",\"4\":\"No\",\"5\":\"1854\"},{\"1\":\"No\",\"2\":\"0.99393225\",\"3\":\"0.006067753\",\"4\":\"No\",\"5\":\"1863\"},{\"1\":\"No\",\"2\":\"0.84493651\",\"3\":\"0.155063490\",\"4\":\"No\",\"5\":\"1883\"},{\"1\":\"No\",\"2\":\"0.97318679\",\"3\":\"0.026813211\",\"4\":\"No\",\"5\":\"1898\"},{\"1\":\"No\",\"2\":\"0.93175653\",\"3\":\"0.068243466\",\"4\":\"No\",\"5\":\"1918\"},{\"1\":\"No\",\"2\":\"0.97888862\",\"3\":\"0.021111380\",\"4\":\"No\",\"5\":\"1922\"},{\"1\":\"Yes\",\"2\":\"0.19269397\",\"3\":\"0.807306028\",\"4\":\"Yes\",\"5\":\"1928\"},{\"1\":\"No\",\"2\":\"0.99309740\",\"3\":\"0.006902600\",\"4\":\"No\",\"5\":\"1937\"},{\"1\":\"No\",\"2\":\"0.99367761\",\"3\":\"0.006322394\",\"4\":\"No\",\"5\":\"1941\"},{\"1\":\"No\",\"2\":\"0.95413911\",\"3\":\"0.045860892\",\"4\":\"No\",\"5\":\"1947\"},{\"1\":\"No\",\"2\":\"0.87162005\",\"3\":\"0.128379953\",\"4\":\"No\",\"5\":\"1948\"},{\"1\":\"No\",\"2\":\"0.79330469\",\"3\":\"0.206695313\",\"4\":\"No\",\"5\":\"1950\"},{\"1\":\"No\",\"2\":\"0.97881665\",\"3\":\"0.021183353\",\"4\":\"No\",\"5\":\"1951\"},{\"1\":\"Yes\",\"2\":\"0.64388231\",\"3\":\"0.356117686\",\"4\":\"Yes\",\"5\":\"1967\"},{\"1\":\"No\",\"2\":\"0.99417185\",\"3\":\"0.005828147\",\"4\":\"No\",\"5\":\"1979\"},{\"1\":\"No\",\"2\":\"0.98745936\",\"3\":\"0.012540636\",\"4\":\"No\",\"5\":\"1989\"},{\"1\":\"No\",\"2\":\"0.87043245\",\"3\":\"0.129567554\",\"4\":\"No\",\"5\":\"1994\"},{\"1\":\"No\",\"2\":\"0.93022487\",\"3\":\"0.069775126\",\"4\":\"No\",\"5\":\"1998\"},{\"1\":\"No\",\"2\":\"0.95222199\",\"3\":\"0.047778009\",\"4\":\"No\",\"5\":\"2019\"},{\"1\":\"No\",\"2\":\"0.98567902\",\"3\":\"0.014320978\",\"4\":\"No\",\"5\":\"2041\"},{\"1\":\"No\",\"2\":\"0.93199529\",\"3\":\"0.068004714\",\"4\":\"No\",\"5\":\"2068\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-6_b7b7170d11dba22a7959bf4120e191b4'}\n\n```{.r .cell-code}\n# 3.2 Single Explanation ----\n\nexplainer <- train_tbl %>%\n    select(-Attrition) %>%\n    lime(\n        model           = automl_leader,\n        bin_continuous  = TRUE,\n        n_bins          = 4,\n        quantile_bins   = TRUE\n    )\n```\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-7_5c603bebcaa5189e57bab63ab631b0da'}\n\n```{.r .cell-code}\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  Connection successful!\n#> \n#> R is connected to the H2O cluster: \n#>     H2O cluster uptime:         1 days 17 hours \n#>     H2O cluster timezone:       Europe/Berlin \n#>     H2O data parsing timezone:  UTC \n#>     H2O cluster version:        3.40.0.4 \n#>     H2O cluster version age:    1 month and 17 days \n#>     H2O cluster name:           H2O_started_from_R_andi_gcu544 \n#>     H2O cluster total nodes:    1 \n#>     H2O cluster total memory:   2.63 GB \n#>     H2O cluster total cores:    4 \n#>     H2O cluster allowed cores:  4 \n#>     H2O cluster healthy:        TRUE \n#>     H2O Connection ip:          localhost \n#>     H2O Connection port:        54321 \n#>     H2O Connection proxy:       NA \n#>     H2O Internal Security:      FALSE \n#>     R Version:                  R version 4.3.0 (2023-04-21)\n```\n:::\n\n```{.r .cell-code}\nexplanation <- test_tbl %>%\n    slice(1) %>%\n    select(-Attrition) %>%\n    lime::explain(\n    \n        # Pass our explainer object\n        explainer = explainer,\n        # Because it is a binary classification model: 1\n        n_labels   = 1,\n        # number of features to be returned\n        n_features = 8,\n        # number of localized linear models\n        n_permutations = 5000,\n        # Let's start with 1\n        kernel_width   = 1\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\ncase_1 <- explanation %>%\n    filter(case == 1)\n\ncase_1 %>%\n    plot_features()\n```\n\n::: {.cell-output-display}\n![](Challenge_5_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-8_7b8d482b200223a0d74feeea34715e97'}\n\n```{.r .cell-code}\nmy_plot_features <- function(data) {\n  g <- data %>% \n    ggplot(aes(x=feature_desc, y=feature_weight)) +\n    geom_col() +\n    coord_flip() +\n    theme_minimal() +\n    labs(y = \"Weight\", x = \"Feature\")\n  return(g)\n}\nmy_plot_features(case_1)\n```\n\n::: {.cell-output-display}\n![](Challenge_5_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='Challenge_5_cache/html/unnamed-chunk-9_effa5985083189bf77da1664e3b76913'}\n\n```{.r .cell-code}\nh2o.init()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  Connection successful!\n#> \n#> R is connected to the H2O cluster: \n#>     H2O cluster uptime:         1 days 22 hours \n#>     H2O cluster timezone:       Europe/Berlin \n#>     H2O data parsing timezone:  UTC \n#>     H2O cluster version:        3.40.0.4 \n#>     H2O cluster version age:    1 month and 18 days \n#>     H2O cluster name:           H2O_started_from_R_andi_gcu544 \n#>     H2O cluster total nodes:    1 \n#>     H2O cluster total memory:   2.59 GB \n#>     H2O cluster total cores:    4 \n#>     H2O cluster allowed cores:  4 \n#>     H2O cluster healthy:        TRUE \n#>     H2O Connection ip:          localhost \n#>     H2O Connection port:        54321 \n#>     H2O Connection proxy:       NA \n#>     H2O Internal Security:      FALSE \n#>     R Version:                  R version 4.3.0 (2023-04-21)\n```\n:::\n\n```{.r .cell-code}\nexplanation <- test_tbl %>%\n    slice(1:20) %>%\n    select(-Attrition) %>%\n    lime::explain(\n        explainer = explainer,\n        n_labels   = 1,\n        n_features = 8,\n        n_permutations = 5000,\n        kernel_width   = 0.5\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n#> \n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\nmy_plot_explanation <- function(data) {\n  g <- data %>% \n    ggplot(aes_(~case, ~feature_desc)) +\n    geom_tile(aes_(fill = ~feature_weight)) +\n    scale_x_discrete('Case', expand = c(0, 0)) +\n    scale_y_discrete('Feature', expand = c(0, 0)) +\n    scale_fill_gradient2('Feature\\nweight', low = 'firebrick', mid = '#f7f7f7', high = 'steelblue') +\n    theme_minimal()\n  if (is.null(explanation$label)) {\n    g\n  } else {\n    g + facet_wrap(~label)\n  }\n}\nmy_plot_explanation(explanation)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: `aes_()` was deprecated in ggplot2 3.0.0.\n#> ℹ Please use tidy evaluation idioms with `aes()`\n```\n:::\n\n::: {.cell-output-display}\n![](Challenge_5_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}