{
  "hash": "ab0a0e8f02b1aa449afc6370edc64344",
  "result": {
    "markdown": "---\ntitle: \"Challenge 2: Regression\"\nauthor: \"Andreas Jessen\"\n---\n\n\n# Load packages:\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-1_54c4f4c9bd18638b85158293e6769668'}\n\n```{.r .cell-code}\n# Standard\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\n# Modeling\nlibrary(parsnip)\n\n# Preprocessing & Sampling\nlibrary(recipes)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attache Paket: 'recipes'\n#> \n#> Das folgende Objekt ist maskiert 'package:stringr':\n#> \n#>     fixed\n#> \n#> Das folgende Objekt ist maskiert 'package:stats':\n#> \n#>     step\n```\n:::\n\n```{.r .cell-code}\nlibrary(rsample)\n\n# Modeling Error Metrics\nlibrary(yardstick)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attache Paket: 'yardstick'\n#> \n#> Das folgende Objekt ist maskiert 'package:readr':\n#> \n#>     spec\n```\n:::\n\n```{.r .cell-code}\n# Plotting Decision Trees\nlibrary(rpart.plot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Lade nötiges Paket: rpart\n```\n:::\n\n```{.r .cell-code}\nlibrary(workflows)\n```\n:::\n\n\n# Data preparation:\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-2_37816758d059723d0fef6a51e5aa8b08'}\n\n```{.r .cell-code}\n# Modeling ----------------------------------------------------------------\nbike_features_tbl <- readRDS(\"Data/bike_features_tbl.rds\")\n\nbike_features_tbl <- bike_features_tbl %>%\n  select(price, model, category_2, frame_material) \n```\n:::\n\n\n# Split data\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-3_6bcd8558e12c1da514e09970e1b76fec'}\n\n```{.r .cell-code}\n# run both following commands at the same time\nset.seed(seed = 1113)\nsplit_obj <- rsample::initial_split(bike_features_tbl, prop   = 0.80, \n                                                       strata = \"category_2\")\n\n# Assign training and test data\ntrain_tbl <- training(split_obj)\ntest_tbl  <- testing(split_obj)\n\n# We have to remove spaces and dashes from the column names\ntrain_tbl <- train_tbl %>% set_names(str_replace_all(names(train_tbl), \" |-\", \"_\"))\ntest_tbl  <- test_tbl  %>% set_names(str_replace_all(names(test_tbl),  \" |-\", \"_\"))\n```\n:::\n\n\n# Model\n\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-4_f3541a8f367e1d85519453fd396c9f2c'}\n\n```{.r .cell-code}\nmodel_reg_lm <- linear_reg(mode = \"regression\") %>% set_engine(\"lm\")\n```\n:::\n\n\n# Recipe\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-5_ead3b3f2efff9f3d0020ec3e850f53ee'}\n\n```{.r .cell-code}\nrecipe_obj <- recipe(price ~ ., data = bike_features_tbl) %>% \n  update_role(model, new_role = \"ID\") %>%\n  step_dummy(all_nominal(), -model, - all_outcomes(), one_hot = T) %>%\n  prep()\n```\n:::\n\n\n# Workflow\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-6_bc25a4dc1f67ad00172295f388dbc455'}\n\n```{.r .cell-code}\nworkflow_obj <- workflow() %>% \n  add_model(model_reg_lm) %>% \n  add_recipe(recipe_obj)\n\nfitted_workflow <- fit(workflow_obj, train_tbl)\n```\n:::\n\n\n# Evaluate model with yardstick\n\n::: {.cell hash='Challenge_2_cache/html/unnamed-chunk-7_ee6f1609c0029bb6392d6408c1dba749'}\n\n```{.r .cell-code}\ncalc_metrics <- function(model, new_data = test_tbl) {\n\n    model %>%\n        predict(new_data = new_data) %>%\n\n        bind_cols(new_data %>% select(price)) %>%\n        yardstick::metrics(truth = price, estimate = .pred)\n\n}\n\nfitted_workflow %>% calc_metrics(test_tbl)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: There are new levels in a factor: E-Road\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\".metric\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"rmse\",\"2\":\"standard\",\"3\":\"1053.4458524\"},{\"1\":\"rsq\",\"2\":\"standard\",\"3\":\"0.5006732\"},{\"1\":\"mae\",\"2\":\"standard\",\"3\":\"768.4889104\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}